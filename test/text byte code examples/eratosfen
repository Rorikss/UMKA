; primes
PUSH_CONST 0
BUILD_ARR 0
STORE 0

PUSH_CONST 0
BUILD_ARR 0
STORE 1

PUSH_CONST 0
STORE 2

L0:
LOAD 2
LOAD 0
LTE
JMP_IF_FALSE L1

LOAD 0
PUSH_CONST 1
CALL 9223372036854775808  ; add(sieve,true)

LOAD 2
PUSH_CONST 2
ADD
STORE 2
JMP L0
L1:

; set sieve[0] = false, sieve[1] = false
LOAD 0
PUSH_CONST 3
PUSH_CONST 4
CALL 9223372036854775804

LOAD 0
PUSH_CONST 5
PUSH_CONST 4
CALL 9223372036854775804

PUSH_CONST 2
STORE 2

L2:
LOAD 2
LOAD 0
LTE
JMP_IF_FALSE L3

LOAD 0
LOAD 2
CALL 9223372036854775805   ; get(sieve,i)
JMP_IF_FALSE L4

LOAD 1
LOAD 2
CALL 9223372036854775808   ; add(result,i)

LOAD 2
LOAD 2
MUL
STORE 3

L5:
LOAD 3
LOAD 0
LTE
JMP_IF_FALSE L6

LOAD 0
LOAD 3
PUSH_CONST 4
CALL 9223372036854775804   ; set(sieve,j,false)

LOAD 3
LOAD 2
ADD
STORE 3
JMP L5
L6:

L4:
LOAD 2
PUSH_CONST 2
ADD
STORE 2
JMP L2
L3:

LOAD 1
RETURN


;main

PUSH_CONST 6      ; 20
CALL 1            ; primes(20)
STORE 0           ; primes_list

LOAD 0
CALL 9223372036854775807 ; print(primes_list)

RETURN
